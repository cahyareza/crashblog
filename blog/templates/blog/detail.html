{% extends 'core/base.html' %}

{% block title %}{{ post.title}} | {% endblock %}

{% block content %}
    <section class="hero is-fullheight">
		<div class="hero-body" id="comment">
			<div class="container has-text-centered">
                <section class="section">
                    <div class="columns is-8 is-variable ">
                        <div class="column is-two-thirds has-text-left">
                            {% if post.image %}
                                <figure class='image mb-6'>
                                    <img src="{{ post.image.url }}">
                                </figure>
                            {% endif %}

                            <div class="content is-medium mt-4">
                                <h1 class="title"><a href="{% url 'post_detail' post.category.slug post.slug %}">{{ post.title }}</a></h1>
                                <div class="subtitle is-6 mt-1">
                                   <p>by {{ post.author }} on {{ post.created_at|date:'M-d-Y' }} in <a href="{% url 'category_detail' post.category.slug %}">{{ post.category }}</a></p>
                                </div>
                                <p> {{ post.body }}</p>
                            </div>

                            <hr>

                            <h2 class="subtitle">Related products</h2>

                            {% with related_posts as post_lists %}
                                {% include 'parts/post_list.html' %}
                            {% endwith %}

                            <hr>

                            {% with comments.count as total_comments %}
                                <h2 class='subtitle is-4'>
                                    {{ total_comments }} comment{{ total_comments|pluralize }}
                                </h2>
                            {% endwith %}

                            <div id="app">
                                {% for comment in comments %}
                                    <article class="media">
                                        <figure class="media-left">
                                            <p class="image is-64x64">
                                                <img src="https://bulma.io/images/placeholders/128x128.png">
                                            </p>
                                        </figure>
                                        <div class="media-content">
                                            <div class="content">
                                                <p>
                                                    <strong>{{ comment.name }}</strong>
                                                    <br>
                                                    {{ comment.body|linebreaks }}
                                                    </br>
                                                    <small><button v-on:click="isShow = true">Reply</button> Â· {{ comment.created_at }}</small>
                                                    <article class="media" v-if="isShow">
                                                        <form method='post' >
                                                            {% csrf_token %}
                                                            <input type="hidden" name="comment_id" value="{{ comment.id }}">
                                                            {{ form.as_p }}

                                                            <div class='field'>
                                                                <div class="control">
                                                                    <button class="button is-primary">Add reply</button>
                                                                </div>
                                                            </div>
                                                            <button v-on:click="isShow = false">Click here to cancel reply.</button>
                                                        </form>
                                                    </article>
                                                </p>
                                            </div>

                                            {% for reply in comment.replies.all %}
                                                <article class="media">
                                                    <figure class="media-left">
                                                        <p class="image is-48x48">
                                                            <img src="https://bulma.io/images/placeholders/96x96.png">
                                                        </p>
                                                    </figure>
                                                    <div class="media-content">
                                                        <div class="content">
                                                            <p>
                                                                <strong>{{ reply.name }}</strong>
                                                                <br>
                                                                {{ reply.body|linebreaks }}
                                                                <br>
                                                                <small>{{ reply.created_at }}</small>

                                                            </p>
                                                        </div>
                                                    </div>
                                                </article>
                                            {% endfor %}
                                        </div>

                                    </article>
                                {% empty %}
                                    <p>There are no comments yet.</p>
                                {% endfor %}

                            </div>

                            <br>

                            {% if new_comment %}
                                <h2>Your comment has been added.</h2>
                            {% else %}
                                <h2 class='subtitle is-4'>Add a new comment</h2>
                                <article class="media">
                                    <form method='post'>
                                        {% csrf_token %}

                                        {{ form.as_p }}

                                        <div class='field'>
                                            <div class="control">
                                                <button class="button is-primary">Add comment</button>
                                            </div>
                                        </div>
                                    </form>
                                </article>
                            {% endif %}


                        </div>

                        {% include 'parts/post_popular.html' %}

                    </div>
                </section>
      	    </div>
        </div>
    </section>
{% endblock %}

{% block scripts %}
    <script>
        const app = new Vue({
            el: '#app',
            delimeters: ['[[', ']]'],
            data: {
                isShow: false,
            },
        })
   </script>
{% endblock %}